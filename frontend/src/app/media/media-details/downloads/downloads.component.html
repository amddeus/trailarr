<div class="downloads-section">
  <div class="title-block">
    <h3>Downloads</h3>
    <!-- <button class="icononly-button" (click)="refreshDownloads()" [disabled]="isLoading()" title="Refresh Downloads">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960" class="refresh-icon">
        <path
          d="M480-160q-134 0-227-93t-93-227q0-134 93-227t227-93q69 0 132 28.5T720-690v-110h80v280H520v-80h168q-32-56-87.5-88T480-720q-100 0-170 70t-70 170q0 100 70 170t170 70q77 0 139-44t87-116h84q-28 106-114 173t-196 67Z"
        />
      </svg>
    </button> -->
  </div>
  <hr />

  @if (hasDownloads()) {
    <div class="downloads-list">
      @for (download of downloads(); track download.id) {
        <div class="download-card">
          <div class="download-main">
            <div class="download-icon">
              @if (download.file_exists) {
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960">
                  <path
                    d="M350-234h177q17.25 0 28.63-11.38Q567-256.75 567-274v-50l82 47v-166l-82 47v-50q0-17.25-11.37-28.63Q544.25-486 527-486H350q-17.25 0-28.62 11.37Q310-463.25 310-446v172q0 17.25 11.38 28.62Q332.75-234 350-234ZM218-64q-28.73 0-50.86-22.14Q145-108.28 145-137v-686q0-28.72 22.14-50.86Q189.27-896 218-896h358l239 240v519q0 28.72-22.14 50.86T742-64H218Zm321-559v-200H218v686h524v-486H539ZM218-823v200-200 686-686Z"
                  />
                </svg>
              } @else {
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960" title="File Deleted">
                  <path
                    d="M880-275 720-435v111l-60-60v-356H304l-60-60h416q24 0 42 18t18 42v215l160-160v410ZM848-27 39-836l42-42L890-69l-42 42ZM482-562Zm-84 84ZM159-800l60 60h-79v520h520v-79l60 60v19q0 24-18 42t-42 18H140q-24 0-42-18t-18-42v-520q0-24 18-42t42-18h19Zm73 482v-21q0-46 45-72.5T400-438q78 0 123 26.5t45 72.5v21H232Z"
                  />
                </svg>
              }
            </div>
            <div class="download-info">
              @if (download.file_exists) {
                <h4 class="download-title">{{ download.file_name }}</h4>
              } @else {
                <h4 class="download-title">{{ download.file_name }} (Deleted)</h4>
              }
              <div class="download-meta">
                <span class="meta-item">{{ download.resolution }}p</span>
                <span class="meta-separator">•</span>
                <span class="meta-item">{{ download.video_format }}</span>
                <span class="meta-separator">•</span>
                <span class="meta-item">
                  {{ download.audio_format }}
                  @if (download.audio_language) {
                    ({{ download.audio_language }})
                  }
                </span>
                @if (download.subtitle_format) {
                  <span class="meta-separator">•</span>
                  <span class="meta-item">
                    {{ download.subtitle_format }}
                    @if (download.subtitle_language) {
                      ({{ download.subtitle_language }})
                    }
                  </span>
                }
                <span class="meta-separator">•</span>
                <span class="meta-item">{{ download.size | fileSize }}</span>
                <span class="meta-separator">•</span>
                <span class="meta-item">{{ download.duration | durationSecondsConvert }}</span>
              </div>
              <div class="download-date">Added: {{ download.added_at | date }}</div>
            </div>
          </div>
          <div class="download-profile">
            <span class="profile-label">Profile:</span>
            @if (download.profile_id === 0) {
              <span class="profile-name">Unknown</span>
            } @else {
              @let profileAvailable = profilesMap().has(download.profile_id);
              @if (profileAvailable) {
                <span class="profile-name link" [routerLink]="['/settings', 'profiles', download.profile_id]">
                  {{ profilesMap().get(download.profile_id) || 'Deleted' }}
                </span>
              } @else {
                <span class="profile-name">Deleted</span>
              }
            }
          </div>
          <div class="download-actions">
            @if (download.youtube_id && !download.youtube_id.startsWith('unknown')) {
              <a [href]="getAppleTVUrl(download.youtube_id)" target="_blank" class="yt-link" title="View on Apple TV">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                  <path
                    d="M18.71 19.5C17.88 20.74 17 21.95 15.66 21.97C14.32 22 13.89 21.18 12.37 21.18C10.84 21.18 10.37 21.95 9.1 22C7.79 22.05 6.8 20.68 5.96 19.47C4.25 17 2.94 12.45 4.7 9.39C5.57 7.87 7.13 6.91 8.82 6.88C10.1 6.86 11.32 7.75 12.11 7.75C12.89 7.75 14.37 6.68 15.92 6.84C16.57 6.87 18.39 7.1 19.56 8.82C19.47 8.88 17.39 10.1 17.41 12.63C17.44 15.65 20.06 16.66 20.09 16.67C20.06 16.74 19.67 18.11 18.71 19.5M13 3.5C13.73 2.67 14.94 2.04 15.94 2C16.07 3.17 15.6 4.35 14.9 5.19C14.21 6.04 13.07 6.7 11.95 6.61C11.8 5.46 12.36 4.26 13 3.5Z"
                  />
                </svg>
              </a>
            }
          </div>
        </div>
      }
    </div>
  }

  @if (!hasDownloads()) {
    <div class="no-downloads">
      <p>No downloads recorded yet.</p>
    </div>
  }
</div>
