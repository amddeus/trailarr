@if (isCreate()) {
  <h2>Add Media Server</h2>
} @else {
  <h2>Edit Media Server</h2>
  <button class="icon-button danger top-right-button" (click)="showDeleteDialog()">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960">
      <path
        d="M259.09-114.02q-28.45 0-48.41-19.89-19.96-19.89-19.96-48.24v-565.94h-45.07v-68.13h198.28v-34.3h271.9v34.3h198.52v68.13h-45.07v565.94q0 27.6-20.33 47.86-20.34 20.27-48.04 20.27H259.09Zm441.82-634.07H259.09v565.94h441.82v-565.94ZM363.89-266.24h64.07v-399h-64.07v399Zm168.15 0h64.31v-399h-64.31v399ZM259.09-748.09v565.94-565.94Z"
      />
    </svg>
    <span class="text">Delete</span>
  </button>
}
<hr />
@if (isLoading() || !mediaServerForm) {
  <app-load-indicator />
} @else {
  <form [id]="'mediaServerForm' + mediaServerId()">
    <!-- Name -->
    <div class="input-group">
      <label for="name">Name</label>
      <input id="name" autocomplete="off" [field]="mediaServerForm.name" placeholder="Media Server Name" type="text" />
      @if (mediaServerForm.name().touched() && mediaServerForm.name().invalid()) {
        @for (error of mediaServerForm.name().errors(); track error) {
          <p class="invalid-text">{{ error.message }}</p>
        }
      }
    </div>

    <!-- Server Type -->
    <div class="option-container">
      <legend id="serverType_label">Server Type:</legend>
      <div class="options-bar" role="radiogroup" aria-labelledby="serverType_label">
        @for (option of serverTypeOptions; track option) {
          <label class="option-label" [class.option__selected]="option === mediaServerCreate().server_type">
            <input type="radio" [id]="'serverType_' + option + '_option'" [value]="option" [field]="mediaServerForm.server_type" />
            <span class="option-name">{{ option | uppercase }}</span>
          </label>
        }
      </div>
    </div>

    <!-- URL -->
    <div class="input-group">
      <label for="url">Server URL</label>
      <input id="url" autocomplete="off" [field]="mediaServerForm.url" placeholder="http://192.168.1.100:8096" type="url" />
      @if (mediaServerForm.url().touched() && mediaServerForm.url().invalid()) {
        @for (error of mediaServerForm.url().errors(); track error) {
          <p class="invalid-text">{{ error.message }}</p>
        }
      }
    </div>

    <!-- API Key -->
    <div class="input-group">
      <label for="apiKey">API Key</label>
      <input id="apiKey" autocomplete="off" [field]="mediaServerForm.api_key" placeholder="API Key" type="text" />
      @if (mediaServerForm.api_key().touched() && mediaServerForm.api_key().invalid()) {
        @for (error of mediaServerForm.api_key().errors(); track error) {
          <p class="invalid-text">{{ error.message }}</p>
        }
      }
    </div>

    <!-- Enabled Toggle -->
    <div class="toggle-container">
      <label for="enabled" class="toggle-label">
        <span>Enabled</span>
        <input type="checkbox" id="enabled" [field]="mediaServerForm.enabled" />
        <span class="toggle-switch"></span>
      </label>
    </div>

    <!-- Result Message -->
    @let _submitResult = submitResult();
    @if (_submitResult) {
      <p class="result-text">{{ _submitResult }}</p>
    }

    <!-- Action Buttons -->
    <div class="buttons-row">
      @if (isReadyToSubmit()) {
        <button
          class="animated-button primary"
          id="submit"
          type="submit"
          [disabled]="!mediaServerForm().dirty() || !mediaServerForm().valid()"
          (click)="onSubmit($event)"
        >
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960">
            <path
              d="M856-690v513q0 28.73-22.14 50.86Q811.72-104 783-104H177q-28.73 0-50.86-22.14Q104-148.27 104-177v-606q0-28.72 22.14-50.86Q148.27-856 177-856h513l166 166Zm-73 32.22L657.78-783H177v606h606v-480.78ZM479.82-238q46.18 0 78.68-32.32 32.5-32.33 32.5-78.5 0-46.18-32.32-78.68-32.33-32.5-78.5-32.5-46.18 0-78.68 32.32-32.5 32.33-32.5 78.5 0 46.18 32.32 78.68 32.33 32.5 78.5 32.5ZM226-577h374v-157H226v157Zm-49-80.78V-177v-606 125.22Z"
            />
          </svg>
          <span class="text">Submit</span>
        </button>
      } @else {
        <button
          class="animated-button primary"
          id="test"
          type="test"
          [disabled]="!mediaServerForm().dirty() || mediaServerForm().invalid()"
          (click)="onSubmit($event)"
        >
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960">
            <path
              d="M766-113q-43 0-76-26t-41-63H443q-67.76 0-111.38-43.67Q288-289.34 288-357.17T331.62-469q43.62-44 111.38-44h77q40.17 0 65.59-25.17 25.41-25.17 25.41-65t-25.35-65.33Q560.3-694 520.21-694H312q-10 37-42.5 63T194-605q-50.92 0-85.96-35.06Q73-675.12 73-726.06t35.04-86.44Q143.08-848 194-848q43 0 75.5 26.5t42.91 62.5H520q68.17 0 112.09 43.88 43.91 43.87 43.91 112 0 68.12-43.91 111.62Q588.17-448 520-448h-77q-39.76 0-64.88 25.38Q353-397.25 353-357.12 353-317 378.12-292q25.12 25 64.88 25h206q9.3-35.81 41.65-62.41Q723-356 766-356q51.33 0 86.67 35.26Q888-285.47 888-234.24 888-183 852.67-148q-35.34 35-86.67 35ZM193.68-678q20.32 0 34.82-13.68 14.5-13.69 14.5-34 0-20.32-14.27-34.82T194.14-775q-20.32 0-34.23 14.27Q146-746.46 146-726.14q0 20.32 13.68 34.23 13.69 13.91 34 13.91Z"
            />
          </svg>
          <span class="text">Test</span>
        </button>
      }
      <button class="animated-button secondary" id="cancel" type="button" (click)="onCancel()">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960">
          <path d="m247-195-51-52 233-233-233-234 51-52 234 234 232-234 51 52-232 234 232 233-51 52-232-234-234 234Z" />
        </svg>
        <span class="text">Cancel</span>
      </button>
    </div>

    @if (_submitResult.toLowerCase().includes('ated success')) {
      <div class="close-progress"></div>
    }
  </form>
}
<dialog #cancelDialog (click)="closeCancelDialog()">
  <div class="dialog-content" (click)="$event.stopPropagation()">
    <h2>Unsaved Changes</h2>
    <p>Changes will be lost. Are you sure you want to cancel?</p>
    <div class="buttons-row">
      <button class="danger" (click)="onConfirmCancel()">Yes</button>
      <button class="primary" (click)="closeCancelDialog()">No</button>
    </div>
  </div>
</dialog>
<dialog #deleteMediaServerDialog (click)="closeDeleteDialog()">
  <div class="dialog-content" (click)="$event.stopPropagation()">
    <h2>Delete Media Server</h2>
    <p>This will remove the media server connection.</p>
    <p>Delete the media server?</p>
    <div class="buttons-row">
      <button class="danger" (click)="onConfirmDelete()">Delete</button>
      <button class="secondary" (click)="closeDeleteDialog()">Cancel</button>
    </div>
  </div>
</dialog>
